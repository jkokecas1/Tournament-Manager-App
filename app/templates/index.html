{% extends "sidebar_layout.html" %}

{% block layout_content %}
<div class="card">
    <div
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <h2 style="margin: 0;">
                {% if show_history %}
                {{ _('Archived Tournaments') }}
                {% else %}
                {{ _('Available Tournaments') }}
                {% endif %}
            </h2>

            {% if show_history %}
            <a href="{{ url_for('main.index', q=search_query) }}" class="btn btn-secondary" style="font-size: 0.9em;">
                ‚¨ÖÔ∏è {{ _('View Active') }}
            </a>
            {% else %}
            <a href="{{ url_for('main.index', history='true', q=search_query) }}" class="btn btn-secondary"
                style="font-size: 0.9em; background-color: #95a5a6;">
                üìú {{ _('View History') }}
            </a>
            {% endif %}
        </div>

        <form action="{{ url_for('main.index') }}" method="get" style="display: flex; gap: 10px; margin-bottom: 0;">
            {% if show_history %}
            <input type="hidden" name="history" value="true">
            {% endif %}
            <input type="text" name="q" value="{{ search_query }}" placeholder="{{ _('Search tournament...') }}"
                style="margin-bottom: 0; width: 250px;">
            <button type="submit" class="btn btn-secondary">{{ _('Search') }}</button>
            {% if search_query %}
            <a href="{{ url_for('main.index', history=show_history) }}" class="btn btn-danger"
                style="text-decoration: none;">&times;</a>
            {% endif %}
        </form>
    </div>

    {% if tournaments %}
    <div class="grid">
        {% for t in tournaments %}
        <a href="{{ url_for('tournaments.tournament_dashboard', t_id=t.id) }}" class="card"
            style="text-decoration: none; color: inherit; border-left: 5px solid #2ecc71; transition: transform 0.2s;">
            <h3 style="margin-top: 0;">üèÜ {{ t.name }}</h3>
            <p style="margin-bottom: 0; color: #7f8c8d;">{{ _('Category') }}: {{ t.category }}</p>
        </a>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if pagination and pagination.pages > 1 %}
    <div style="margin-top: 30px; display: flex; justify-content: center; gap: 10px; align-items: center;">
        {% if pagination.has_prev %}
        <a href="{{ url_for('main.index', page=pagination.prev_num, q=search_query) }}"
            class="btn btn-secondary">&laquo; {{
            _('Previous') }}</a>
        {% endif %}

        <span style="color: #666;">{{ _('Page') }} {{ pagination.page }} {{ _('of') }} {{ pagination.pages }}</span>

        {% if pagination.has_next %}
        <a href="{{ url_for('main.index', page=pagination.next_num, q=search_query) }}" class="btn btn-secondary">{{
            _('Next') }} &raquo;</a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <p style="text-align: center; color: #7f8c8d; padding: 40px;">{{ _('No tournaments found matching your search.') }}
    </p>
    {% endif %}
</div>

{% if current_user and current_user.role == 'admin' %}
<div class="card" style="margin-top: 20px; border-top: 3px solid var(--augment);">
    <h3 style="margin-top: 0;">{{ _('Create New Tournament') }}</h3>
    <form action="{{ url_for('tournaments.create_tournament') }}" method="post">
        <div style="margin-bottom: 15px;">
            <input type="text" name="name" placeholder="{{ _('Tournament Name') }}" required style="width: 100%;">
        </div>
        <div style="margin-bottom: 15px;">
            <input type="text" name="category" placeholder="{{ _('Category (e.g., U12)') }}" required
                style="width: 100%;">
        </div>

        <h4 style="margin-bottom: 10px;">{{ _('Points System') }}</h4>
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
            <div>
                <label style="display: block; font-size: 0.8em; color: #666;">{{ _('Win') }}</label>
                <input type="number" name="win_points" value="3" style="width: 80px;">
            </div>
            <div>
                <label style="display: block; font-size: 0.8em; color: #666;">{{ _('Draw') }}</label>
                <input type="number" name="draw_points" value="1" style="width: 80px;">
            </div>
            <div>
                <label style="display: block; font-size: 0.8em; color: #666;">{{ _('Loss') }}</label>
                <input type="number" name="loss_points" value="0" style="width: 80px;">
            </div>
        </div>

        <button type="submit" class="btn btn-primary">{{ _('Create Tournament') }}</button>
    </form>
</div>
{% endif %}
{% endblock %}